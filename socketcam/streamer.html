<!DOCTYPE html>
<html>
<head><title>Streamer</title></head>
<body>
<h2>Streamer</h2>
<video id="preview" autoplay muted playsinline width="600"></video>

<script>
const preview = document.getElementById('preview');
const ws = new WebSocket("wss://models.staging3.dotwibe.com/webrtcsocket"); 
const pc = new RTCPeerConnection({ iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] });

ws.onopen = () => ws.send(JSON.stringify({ type: 'streamer' }));

navigator.mediaDevices.getUserMedia({ video: true, audio: true }).then(stream => {
    preview.srcObject = stream;
    stream.getTracks().forEach(track => pc.addTrack(track, stream));

    pc.onicecandidate = ({ candidate }) => {
        if (candidate) ws.send(JSON.stringify({ to: 'viewer', payload: { candidate } }));
    };

    pc.createOffer().then(offer => {
        pc.setLocalDescription(offer);
        ws.send(JSON.stringify({ to: 'viewer', payload: { offer } }));
    });
});

ws.onmessage = ({ data }) => {
    const msg = JSON.parse(data);
    if (msg.answer) pc.setRemoteDescription(new RTCSessionDescription(msg.answer));
    if (msg.candidate) pc.addIceCandidate(new RTCIceCandidate(msg.candidate));
};
</script>
</body>
</html>
