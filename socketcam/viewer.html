<!DOCTYPE html>
<html>
<head><title>Viewer</title></head>
<body>
<h2>Viewer</h2>
<video id="remote" autoplay playsinline controls width="600"></video>

<script>
const remote = document.getElementById('remote');
const ws = new WebSocket('ws://localhost:3000');
const pc = new RTCPeerConnection({ iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] });

ws.onopen = () => ws.send(JSON.stringify({ type: 'viewer' }));

pc.onicecandidate = ({ candidate }) => {
    if (candidate) ws.send(JSON.stringify({ to: 'streamer', payload: { candidate } }));
};

pc.ontrack = (event) => remote.srcObject = event.streams[0];

ws.onmessage = ({ data }) => {
    const msg = JSON.parse(data);
    if (msg.offer) {
        pc.setRemoteDescription(new RTCSessionDescription(msg.offer));
        pc.createAnswer().then(answer => {
            pc.setLocalDescription(answer);
            ws.send(JSON.stringify({ to: 'streamer', payload: { answer } }));
        });
    }
    if (msg.candidate) pc.addIceCandidate(new RTCIceCandidate(msg.candidate));
};
</script>
</body>
</html>
